<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>회원권 정지 등록</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container mt-5">
    <h2 class="mb-4">회원권 정지 등록</h2>

    <form th:action="@{/membership/suspend/register}" th:object="${suspend}" method="post">

        <!-- membershipId는 hidden으로 전달 -->
        <input type="hidden" th:field="*{membershipId}" />

        <!-- 관리자 ID도 hidden으로 전달 -->
        <input type="hidden" th:field="*{createdBy}" />

        <!-- 정지 시작일 -->
        <div class="mb-3">
            <label for="suspendStartDate" class="form-label">정지 시작일</label>
            <input type="date" class="form-control" id="suspendStartDate" th:field="*{suspendStartDate}" required>
        </div>

        <!-- 정지 종료일 -->
        <div class="mb-3">
            <label for="suspendEndDate" class="form-label">정지 종료일</label>
            <input type="date" class="form-control" id="suspendEndDate" th:field="*{suspendEndDate}" required>
        </div>

        <!-- 정지 사유 -->
        <div class="mb-3">
            <label for="suspendReason" class="form-label">정지 사유</label>
            <textarea class="form-control" id="suspendReason" th:field="*{suspendReason}" rows="3" required></textarea>
        </div>

        <!-- 기존 종료일 -->
        <input type="date" class="form-control" id="endDate" th:value="${membership.endDate}" style="display: none;">

        <!-- 새로운 종료일 -->
        <div class="mb-3">
            <label for="extendedEndDate" class="form-label">새로운 종료일</label>
            <input type="date" class="form-control" id="extendedEndDate" th:field="*{extendedEndDate}" readonly>
        </div>

        <button type="submit" class="btn btn-primary">정지 등록</button>
        <a th:href="@{/membership/list}" class="btn btn-secondary">취소</a>

    </form>
</div>

<script>
    // 새로운 종료일 계산
    function calculateExtendedEndDate() {
        const suspendStart = document.getElementById('suspendStartDate').value;
        const suspendEnd = document.getElementById('suspendEndDate').value;
        const originalEnd = document.getElementById('endDate').value;
        const extendedEndInput = document.getElementById('extendedEndDate');

        if(!suspendStart || !suspendEnd || !originalEnd) {
            extendedEndInput.value = '';
            return;
        }

        const suspendStartDate = new Date(suspendStart);
        const suspendEndDate = new Date(suspendEnd);
        const originalEndDate = new Date(originalEnd);

        // 종료일이 시작일보다 빠르면 안됨
        if(suspendStartDate > suspendEndDate) {
            alert('정지 종료일은 정지 시작일보다 빠를 수 없습니다.');
            extendedEndInput.value = '';
            return;
        }

        // 정지 기간 계산
        const suspendDuration = Math.ceil((suspendEndDate - suspendStartDate) / (1000 * 60 * 60 * 24)) + 1;

        // 새로운 종료일 계산
        const newEndDate = new Date(originalEndDate);
        newEndDate.setDate(newEndDate.getDate() + suspendDuration);

        extendedEndInput.value = newEndDate.toISOString().split('T')[0]; // yyyy-MM-dd 포맷
    }

    // 이벤트 연결
    document.getElementById('suspendStartDate').addEventListener('change', calculateExtendedEndDate);
    document.getElementById('suspendEndDate').addEventListener('change', calculateExtendedEndDate);
</script>

</body>
</html>
