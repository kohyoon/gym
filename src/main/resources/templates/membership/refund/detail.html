<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8">
  <title sec:authorize="hasRole('ADMIN')">[관리자] 환불 상세</title>
  <title sec:authorize="hasRole('MEMBER')">[회원] 환불 상세</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
  <h2 class="mb-4">환불 상세 정보</h2>

  <!-- 회원권 정보 -->
  <div class="card mb-4">
    <div class="card-header bg-primary text-white">회원권 정보</div>
    <div class="card-body">
      <p><strong>회원권 ID:</strong> <span th:text="${membership.membershipId}"></span></p>
      <p><strong>회원권 종류:</strong> <span th:text="${membership.membershipType}"></span></p>
      <p><strong>가격:</strong> <span th:text="${membership.price} + '원'"></span></p>
      <p><strong>기간:</strong> <span th:text="${membership.periodDays} + '일'"></span></p>
    </div>
  </div>

  <!-- 환불 정보 -->
  <div class="card mb-4">
    <div class="card-header bg-warning">환불 정보</div>
    <div class="card-body">
      <p><strong>환불 ID:</strong> <span th:text="${refund.refundId}"></span></p>
      <p><strong>회원 이름:</strong> <span th:text="${refund.memberName}"></span></p>
      <p><strong>환불 금액:</strong> <span th:if="${refund.refundAmount != null}" th:text="${refund.refundAmount} + '원'"></span></p>
      <p><strong>환불 사유:</strong> <span th:text="${refund.refundReason}"></span></p>
      <p><strong>요청일:</strong> <span th:text="${#temporals.format(refund.requestedAt, 'yyyy-MM-dd HH:mm')}"></span></p>
      <p><strong>요청자:</strong> <span th:text="${refund.requestedByName}"></span></p>
      <p><strong>상태:</strong>
        <span th:switch="${refund.refundStatus.name()}">
          <span th:case="REQUESTED" class="badge bg-warning text-dark">요청됨</span>
          <span th:case="PENDING" class="badge bg-secondary text-dark">검토중</span>
          <span th:case="APPROVED" class="badge bg-success">승인</span>
          <span th:case="REJECTED" class="badge bg-danger">반려</span>
        </span>
      </p>
    </div>
  </div>

  <!-- 환불 로그 -->
  <div class="card">
    <div class="card-header bg-secondary text-white">환불 로그</div>
    <div class="card-body">
      <table class="table table-bordered table-hover">
        <thead class="table-light">
        <tr>
          <th>로그 ID</th>
          <th>유형</th>
          <th>내용</th>
          <th>수행 일시</th>
          <th>수행자</th>
          <th>역할</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="log : ${refund.logs}">
          <td th:text="${log.logId}"></td>
          <td th:text="${log.logType}"></td>
          <td th:text="${log.logDetail}"></td>
          <td th:text="${#temporals.format(log.performedAt, 'yyyy-MM-dd')}"></td>
          <td th:text="${log.performedByName}"></td>
          <td>
            <span th:if="${log.actorRole.name() == 'MEMBER'}">회원</span>
            <span th:if="${log.actorRole.name() == 'ADMIN'}">관리자</span>
          </td>
        </tr>
        <tr th:if="${#lists.isEmpty(refund.logs)}">
          <td colspan="6" class="text-center">로그 내역이 없습니다.</td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- 버튼 -->
  <div class="mt-4" sec:authorize="hasRole('MEMBER')">
    <a th:href="@{/member/refund/list}" class="btn btn-secondary">목록으로</a>
  </div>

  <!-- 버튼 -->
  <div class="mt-4" sec:authorize="hasRole('ADMIN')">
    <button type="button" class="btn btn-secondary">검토중</button>
    <button type="button" class="btn btn-secondary">승인</button>
    <button type="button" class="btn btn-secondary">거절</button>
    <a th:href="@{/admin/refund/list}" class="btn btn-secondary">목록으로</a>
  </div>
</div>
</body>
</html>
